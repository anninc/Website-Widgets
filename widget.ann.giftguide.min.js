/*
 *	== ANN, Inc. GiftGuide ==
 *
 *	@author Ryan Provost (ryan_provost@anninc.com)
 *	@created 2011-10-25
 */
(function(a){a.fn.GiftGuide=function(b){function l(b){var g=Math.floor(Math.random()*(b.images-1))+1;var h=Math.floor(Math.random()*d.length);if(d.length===0&&e){
e=false;clearInterval(f);f=setInterval(function(){l(b)},b.speed)}if(d.length===0)for(i=1;i<b.positions;i++)d.push(i);a(c+".story.splash .image:nth-child("+d[h]+")"
).html('<img width="50" height="45" src="'+b.path+g+'.jpg" />');a(c+".story.splash .image:nth-child("+d[h]+")").find("img").fadeIn(b.fade);d.splice(h,1)}var c=this;
var d=new Array;var e=true;var f=0;var g="#";var h="#";var j;var k;a(this).css({position:"relative"});a(this).wrap('<div class="'+this.attr("class")+' wrapper"></div>');
a(this).parent().css({position:"relative",height:a(c).height(),width:a(c).width()+40});a.getJSON(b,function(b){function m(d){var d=d;a.each(j.story,function(a){if(
j.story[a].id==d)d=j.story[a]});a(c).parent().find(".navigation .link:not(."+d.id+")").css("color",b.navigation.colors.off);a(c).parent().find(".navigation .link:not(."+d.id+")"
).hover(function(){a(this).css("color",b.navigation.colors.on)});a(c).parent().find(".navigation .link:not(."+d.id+")").mouseout(function(){a(this).css(
"color",b.navigation.colors.off)});a(c).parent().find(".navigation .link."+d.id).hover(function(){a(this).css("color",b.navigation.colors.on)});a(c).parent().find(
".navigation .link."+d.id).mouseout(function(){a(this).css("color",b.navigation.colors.on)});a(c).parent().find(".navigation .link."+d.id).css("color",b.navigation.colors.on);
var e=0;if(k){if(k==="splash"){var f=b.splash.config.duration;a(".story.splash").fadeOut(f);e=Number(f)*.8}else{a.each(k.elements,function(a,b){var c=Number(
b.animation.delay)+Number(b.animation.duration);if(e<c)e=c});a.each(k.elements,function(b,d){var f=e-(Number(d.animation.delay)+Number(d.animation.duration));
a(c+".story.visible").find(".article."+b).delay(f).fadeOut(d.animation.duration)});a(c+".story.visible").delay(e-Number(k.animation.delay)).fadeOut(k.animation.duration,"linear");
e=e+Number(k.animation.duration)*.8}a(c+".story.visible").toggleClass("visible")}setTimeout(function(){if(d=="splash"){a(".story.splash").fadeIn();
a(".story."+d.id).toggleClass("visible");k="splash"}else{a(".story."+d.id).fadeIn(d.animation.duration,"linear");a(".story."+d.id).toggleClass("visible");
a.each(d.elements,function(b,d){a(c+".story.visible").find(".article."+b).delay(d.animation.delay).fadeIn(d.animation.speed)})}},e);k=d}j=b.stories;a(c).append(
'<div class="whitewash"><img src="'+j.whitewash+'"></div>');a(c).find(".whitewash").css({display:"none",position:"absolute",top:"0",left:"-978",width:"1956",height:a(c).height()}
);a(c).parent().append('<div class="navigation"><img src="'+b.navigation.header+'"/></div>');a(c).parent().append('<img class="nav tab" src="'+b.navigation.tabs.left+'" />');
a(c).parent().append('<div class="left arrow"><img src="'+b.navigation.arrows.left+'"/></div>');a(c).parent().append('<img class="left tab" src="'+b.navigation.tabs.left+'" />');
a(c).parent().append('<div class="right arrow"><img src="'+b.navigation.arrows.right+'"/></div>');a(c).parent().append('<img class="right tab" src="'+b.navigation.tabs.right+'" />');
if(b.splash)a(c).append('<div class="story splash"></div>');a(c+".story.splash").click(function(){window.location=b.splash.link});a.each(j.story,function(b,d){a(c).append(
'<div class="story '+d.id+'"></div>');a(c+".story."+d.id).css({"background-image":"url("+d.background+")"});a(c+".story."+d.id).click(function(){window.location=d.link});
a(c).parent().find(".navigation").append('<a class="link '+d.id+'" href="#">'+d.title+"  ›</a><br/>");a.each(d.elements,function(b,e){setTimeout(function(){a(c+".story."+d.id
).append('<img class="article '+b+'" src="'+e.image+'">');a(c+".story."+d.id).find(".article."+b).css({display:"none",position:"absolute",top:e.top+"px",left:e.left+"px",
"z-index":e.layer});a(c+".story."+d.id).find(".article."+b).mouseover(function(){a(c+".story."+d.id).find(".tag."+b).fadeIn()});a(c+".story."+d.id).find(".article."+b).mouseout(
function(){a(c+".story."+d.id).find(".tag."+b).fadeOut()})},1);if(e.tag){var f=e.tag.text.split("|")[0];var g=e.tag.text.split("|")[1];if(g==undefined)g="";a(c+".story."+d.id
).append('<div class="tag '+b+'"><div class="title">'+f+"</div>"+g+"</div>");a(c+".story."+d.id).find(".tag."+b).css({display:"none",position:"absolute",top:e.tag.top+"px",
left:e.tag.left+"px",width:e.tag.width,"z-index":e.layer+1})}})});var e=b.splash.config;a(c+".story.splash").append('<div class="images"></div>');a(c+".story.splash .images").append(
'<div class="welcome"><img src="'+e.path+b.splash.text+'" /></div>');for(i=1;i<e.positions;i++){setTimeout(function(){a(c+".story.splash .images").append('<div class="image"></div>');
var b=Math.floor(Math.random()*(e.images-1))+1;a(c+".story.splash .image:last-child").html('<img src="'+e.path+b+'.jpg" />')},1);d.push(i)}f=setInterval(function(){l(e)},1);
a(c).parent().find(".link").click(function(){var b=a(this).attr("class").split(" ")[1];window.location="#"+b;return false});a(window).hashchange(function(){var b=location.hash.substr(1);
if(b.length==0)window.location="#splash";var d=0;a.each(j.story,function(a,c){if(c.id==b)d=a});if(d-1<0){g="#splash"}else{g="#"+j.story[d-1].id}if(b=="splash"){
h="#"+j.story[0].id}else if(d+1<j.story.length){h="#"+j.story[d+1].id}a(c).parent().find(".arrow.right").click(function(){window.location=h});a(c).parent().find(".arrow.left").click(
function(){window.location=g});m(b)});a(window).hashchange()})}})(jQuery)