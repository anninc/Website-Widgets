/*
 *	== ANN, Inc. SlideShow ==
 *	This plugin will take a custom JSON object as input and generate a
 *	swipe-able, accessible slideshow in the LOFT StyleCloset form.
 *
 *	@author Ryan Provost (ryan_provost@anninc.com)
 *	@created 2011-10-25
 *	@updated 2011-11-28
 */
(function(a){a.fn.SlideShow=function(b){var c=b.config;var d=b.sections;var e=1;a(this).css({overflow:"hidden"});var f=Array();var g="";if(c.splash){var h=c.splash;h.parent="splash";h.pageId=1;f.push(h)}a.each(d.section,function(b,c){a.each(c.pages,function(a,b){if(g!=c.id)pageid=1;b.parent=c.id;b.pageId=pageid;b.arrows=c.arrows;f.push(b);g=c.id;pageid++})});a(this).append('<div class="pages">');if(d.section.length>1){a(this).append('<div class="sections">');a(".sections").append('<div class="sectionList">');a(this).append('<div class="nav section left">');a(this).append('<div class="nav section right">');if(c.navigation){a(this).find(".nav.section.left").loadImage({path:c.navigation.arrows.left.off,over:c.navigation.arrows.left.over});a(this).find(".nav.section.right").loadImage({path:c.navigation.arrows.right.off,over:c.navigation.arrows.right.over})}}a(this).append('<div class="nav page left">');a(this).append('<div class="nav page right">');a.each(d.section,function(b,c){if(c.navigation){a(".sections .sectionList").append('<div class="section">');setTimeout(function(){a(".sections .sectionList .section:nth-child("+(b+1)+")").loadImage({path:c.navigation.image,alt:c.navigation.alt,title:c.navigation.title,over:c.navigation.over});a(".sections .sectionList .section:nth-child("+(b+1)+")").click(function(){window.location="#"+c.id})},1)}});a.each(f,function(b,c){var d=b;var f=a(".pages").width()*d;a(".pages").append("<div class='page "+c.parent+" "+c.pageId+"'></div>");a(".pages .page."+c.parent+"."+c.pageId).css({position:"absolute",top:0,left:f});setTimeout(function(){a(".pages").append('<a href="'+c.link+'" class="accessible '+c.parent+" "+c.pageId+'" tabindex="'+e+'" style="font-size:1pt;">'+c.alt+"</a>");a(".pages .page."+c.parent+"."+c.pageId).hover().css({cursor:"pointer"});a(".pages .page."+c.parent+"."+c.pageId).click(function(){if(a.browser.msie&&Number(a.browser.version.split(".")[0])<9){setTimeout(function(){window.location=c.link},750)}else{window.location=c.link}});a(".pages .accessible."+c.parent+"."+c.pageId).focus(function(){window.location="#"+c.parent+":"+c.pageId;return false});e++},1);if(c.map){setTimeout(function(){map='<map name="'+c.parent+c.pageId+'">';for(i=0;i<c.map.length;i++){var d='class="area '+c.parent+" page"+b+" map"+i+'"';var e='shape="'+c.map[i].shape+'"';var g='coords="'+c.map[i].coords+'"';if(c.map[i].link){var h='href="'+c.map[i].link+'"'}else{var h='href="'+c.link+'"'}if(c.map[i].alt)var j='alt="'+c.map[i].alt+'"';map=map+"<area "+d+" "+e+" "+g+" "+h+" "+j+" />";if(c.map[i].hover){var k=c.map[i].hover;a(".pages").append('<img class="hover page'+b+" map"+i+'" src="'+k.image+'" onclick="window.location=\''+c.link+"';\" />");a(".pages .hover.page"+b+".map"+i).css({display:"none",position:"absolute",left:f+Number(k.left)+"px",top:k.top+"px"})}}map=map+"</map>";a(map).appendTo(".pages")},1)}});a(".pages").width(a(this).width()*f.length);a(".area").live("click",function(){areaClicked=true});a(".area").live("mouseover",function(){var b=a(this).attr("class").split(" ")[2];var c=a(this).attr("class").split(" ")[3];a(".pages .hover."+b+"."+c).fadeIn("fast")});a(".area").live("mouseout",function(b){var c=a(this).attr("class").split(" ")[2];var d=a(this).attr("class").split(" ")[3];if(b.relatedTarget.className!="hover "+c+" "+d){a(".pages .hover."+c+"."+d).fadeOut("fast")}});a(".pages").find("a").css({position:"absolute",top:"5px",width:"1px",height:"px","font-size":"1pt",opacity:"0","z-index":"-1"});var j=a(".sections").width();var k=a(".sections .sectionList .section").outerWidth(true);var l=a(".sections .sectionList .section").length;var m=Math.ceil(j/k);var n=l*k;var o=n-(m-c.objectsToScroll)*k;var p=k*c.objectsToScroll;a(".nav.section.left").click(function(){scrollLeft=a(".sections").scrollLeft()-p});a(".nav.section.right").click(function(){scrollLeft=a(".sections").scrollLeft()+p});a(".nav.section").click(function(){a(".nav.section.left").css("opacity","1");a(".nav.section.right").css("opacity","1");if(scrollLeft-p<0)a(".nav.section.left").css("opacity",".15");if(scrollLeft+p>=n)a(".nav.section.right").css("opacity",".15");if(scrollLeft<n&&scrollLeft>=0)a(".sections").animate({scrollLeft:scrollLeft},c.scrollSpeed);return false});a(".nav.page.left").click(function(){window.location=prevLink;return false});a(".nav.page.right").click(function(){window.location=nextLink;return false});a(".pages").wipetouch({wipeLeft:function(a){window.location=nextLink},wipeRight:function(a){window.location=prevLink}});a(".sections").wipetouch({wipeLeft:function(b){var d=a(".sections").scrollLeft()+p;if(d<n)a(".sections").animate({scrollLeft:d},c.scrollSpeed)},wipeRight:function(b){var d=a(".sections").scrollLeft()-p;a(".sections").animate({scrollLeft:d},c.scrollSpeed)}});a(window).hashchange(function(){var b=location.hash.substr(1);var d=b.split(":")[0];var e=b.split(":")[1];var g=0;if(d.length==0){d=f[0].parent;if(c.splash)d=f[0].parent}if(e==undefined)e=1;if(b.split(":")[0].length==0&&b.split(":")[1]==undefined){window.location="#"+d+":"+e}a(f).each(function(a,b){if(b.parent==d&&b.pageId==e)g=a});if(g-1>=0)prevLink="#"+f[g-1].parent+":"+f[g-1].pageId;if(g+1<f.length)nextLink="#"+f[g+1].parent+":"+f[g+1].pageId;var h=a(".pages").find(".page."+d+"."+e).css("left");a(".pages").find(".page."+d+"."+e).loadImage({path:f[g].image});if(f[g].map)a(".pages").find(".page."+d+"."+e).find(".display").attr("usemap","#"+f[g].parent+f[g].pageId);if(g+1<f.length){a(".page."+f[g+1].parent+"."+f[g+1].pageId).loadImage({path:f[g+1].image})}if(g-1>=0){a(".page."+f[g-1].parent+"."+f[g-1].pageId).loadImage({path:f[g-1].image})}a(".pages").animate({right:h},500);var i="0.25";if(f[g].arrows.left.inactiveOpacity)i=f[g].arrows.left.inactiveOpacity;a(".page.nav.left").css({opacity:i});a(".page.nav.left").loadImage({path:f[g].arrows.left.off,over:f[g].arrows.left.over});if(g-1>=0)a(".page.nav.left").css({opacity:"1"});a(".page.nav.right").css({opacity:i});a(".page.nav.right").loadImage({path:f[g].arrows.right.off,over:f[g].arrows.right.over});if(g+1<f.length)a(".page.nav.right").css({opacity:"1"})});a(window).hashchange()}})(jQuery)